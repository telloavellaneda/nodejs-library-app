<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">
    <ui:define name="content">
        <h:form id="usuarios-form">
            <div align="center">
                <p:commandButton value="Agregar Nuevo Usuario" icon="ui-icon-pencil" styleClass="green-btn" oncomplete="PF('createUser').show();" action="#{catalogoUsuariosController.nuevo}" update=":panel"/>
            </div>
            <p:spacer height="10px" />
            <p:dataTable var="usuario" value="#{catalogoUsuariosController.catalogoUsuariosForm.usuarios}" styleClass="table" rows="15" paginator="true" paginatorPosition="bottom" emptyMessage="No hay usuarios">
                <f:facet name="header">
                    <h:outputLabel value="Usuarios del Sistema"/>
                </f:facet>
                <p:column headerText="Nombre" sortBy="#{usuario.nombre} #{usuario.apaterno} #{usuario.amaterno}" filterBy="#{usuario.nombre} #{usuario.apaterno} #{usuario.amaterno}" filterMatchMode="contains" styleClass="filtro-float">
                    <h:outputText value="#{usuario.nombre} #{usuario.apaterno} #{usuario.amaterno}"/>
                </p:column>
                <p:column headerText="Usuario" sortBy="#{usuario.usuario}" priority="5">
                    <h:outputText value="#{usuario.usuario}" />
                </p:column>
                <p:column headerText="Empresa" sortBy="#{usuario.empresa}" priority="5">
                    <h:outputText value="#{usuario.empresa}" />
                </p:column>
                <p:column headerText="Tipo" sortBy="#{usuario.tipousuarioid.tipousuarioid}"  priority="4">
                    <h:outputText value="#{usuario.tipousuarioid.descripcion}" />
                </p:column>
                <p:column headerText="Editar" styleClass="centrado" style="width: 40px">
                    <p:commandButton icon="ui-icon-pencil" styleClass="amber-btn" oncomplete="PF('createUser').show()" update=":panel" action="#{catalogoUsuariosController.modificarUsuario(usuario, 1)}"/>
                </p:column>
                <p:column headerText="Contr." styleClass="centrado" style="width: 40px">
                    <p:commandButton icon="ui-icon-lock" oncomplete="PF('createUser').show()" update=":panel" action="#{catalogoUsuariosController.modificarUsuario(usuario, 2)}"/>
                </p:column>
                <p:column  headerText="Borrar" styleClass="centrado" style="width: 40px">
                    <p:commandButton icon="ui-icon-trash" styleClass="red-btn" onclick="PF('confirmation').show();">
                        <f:setPropertyActionListener value="#{usuario}" target="#{catalogoUsuariosController.catalogoUsuariosForm.usuario}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </h:form>

        <p:dialog widgetVar="createUser" height="50vh" width="30%" header="Usuario" closable="true" draggable="false" resizable="false" modal="true">
            <h:form id="panel">
                <p:panelGrid style="width: 100%">
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarUsuario}">
                        <p:column width="50%">
                            <p:outputLabel  value="Nombre" for="nombre" />
                        </p:column>
                        <p:column width="50%">
                            <p:inputText id="nombre" value="#{catalogoUsuariosController.catalogoUsuariosForm.usuario.nombre}"  required="true"  requiredMessage="Nombre requerido" />
                        </p:column>
                    </p:row>
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarUsuario}">
                        <p:column width="50%">
                            <p:outputLabel value="A. Paterno" for="paterno" />
                        </p:column>
                        <p:column width="50%">
                            <p:inputText id="paterno" value="#{catalogoUsuariosController.catalogoUsuariosForm.usuario.apaterno}"  required="true" requiredMessage="Apellido paterno requerido" />
                        </p:column>
                    </p:row>
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarUsuario}">
                        <p:column width="50%">
                            <p:outputLabel  value="A. Materno" for="materno" />
                        </p:column>
                        <p:column width="50%">
                            <p:inputText id="materno" value="#{catalogoUsuariosController.catalogoUsuariosForm.usuario.amaterno}" required="true" requiredMessage="Apellido materno requerido" />
                        </p:column>
                    </p:row>
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarUsuario}">
                        <p:column width="50%">
                            <p:outputLabel  value="Tipo de Usuario" />
                        </p:column>
                        <p:column width="50%">
                            <p:selectOneMenu value="#{catalogoUsuariosController.catalogoUsuariosForm.usuario.tipousuarioid.tipousuarioid}" style="width: 120px" rendered="#{catalogoUsuariosController.catalogoUsuariosForm.usuarioSesion.tipousuarioid.tipousuarioid == 3}">
                                <f:selectItem itemLabel="Supervisor" itemValue="3" />
                                <f:selectItem itemLabel="Usuario Final" itemValue="2" />
                            </p:selectOneMenu>
                            <p:selectOneMenu value="#{catalogoUsuariosController.catalogoUsuariosForm.usuario.tipousuarioid.tipousuarioid}" style="width: 120px" rendered="#{catalogoUsuariosController.catalogoUsuariosForm.usuarioSesion.tipousuarioid.tipousuarioid == 1}">
                                <f:selectItem itemLabel="Supervisor" itemValue="3" />
                                <f:selectItem itemLabel="Usuario Final" itemValue="2" />
                                <f:selectItem itemLabel="Administrador" itemValue="1" />
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarUsuario}">
                        <p:column width="50%">
                            <p:outputLabel  value="Empresa" for="empresa" />
                        </p:column>
                        <p:column width="50%">
                            <p:inputText id="empresa" value="#{catalogoUsuariosController.catalogoUsuariosForm.usuario.empresa}" size="20"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2" rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarUsuario}">
                            <p:spacer height="15px"/>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarContrasenia}">
                        <p:column width="50%">
                            <p:outputLabel value="Usuario" for="Usuario" />
                        </p:column>
                        <p:column width="50%">
                            <p:inputText  id="Usuario" value="#{catalogoUsuariosController.catalogoUsuariosForm.usuario.usuario}" required="true" requiredMessage="Usuario requerido" maxlength="50" readonly="#{!catalogoUsuariosController.catalogoUsuariosForm.nuevoUsuario}">
                                <p:ajax update="Usuario" event="blur" listener="#{catalogoUsuariosController.validaUsuario}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarContrasenia}">
                        <p:column width="50%">
                            <p:outputLabel for="pwd1" value="Contraseña" />
                        </p:column>
                        <p:column width="50%">
                            <p:password id="pwd1" value="#{catalogoUsuariosController.catalogoUsuariosForm.contrasenia}" match="pwd2" label="Password 1" required="true" requiredMessage="Contraseña requerida" feedback="true" weakLabel="Seguridad Baja" goodLabel="Seguridad Media" strongLabel="Seguridad Alta" promptLabel="Indroduzca una Contraseña"/>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{catalogoUsuariosController.catalogoUsuariosForm.modificarContrasenia}">
                        <p:column width="50%">
                            <p:outputLabel for="pwd2" value="Confirmar Contraseña" />
                        </p:column>
                        <p:column width="50%">
                            <p:password id="pwd2" value="#{catalogoUsuariosController.catalogoUsuariosForm.contrasenia2}" label="Password 2" required="true" requiredMessage="Confirmacion de contraseña requerida"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <div align="center">
                    <p:commandButton value="Guardar" styleClass="green-btn" oncomplete="PF('createUser').hide();" update=":usuarios-form" action="#{catalogoUsuariosController.guardar}"/>
                    <p:commandButton value="Cancelar" styleClass="red-btn" onclick="PF('createUser').hide();"/>
                </div>
            </h:form>
        </p:dialog>

        <h:form id="confirmDialog">
            <p:confirmDialog message="¿Desea dar de baja el usuario?" header="Baja" severity="alert" widgetVar="confirmation">
                <div align="center">
                    <p:commandButton id="confirm" value="Sí" icon="ui-icon-check" styleClass="green-btn" update=":usuarios-form" oncomplete="PF('confirmation').hide()" actionListener="#{catalogoUsuariosController.borrar}"/>
                    <p:commandButton id="decline" value="No" icon="ui-icon-close" styleClass="red-btn" onclick="PF('confirmation').hide()"/>
                </div>
            </p:confirmDialog>
        </h:form>
    </ui:define>
</ui:composition>